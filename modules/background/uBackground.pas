unit uBackground;

{$mode objfpc}{$H+}

interface

uses
  Classes, SysUtils, uModulAPI, windows, uUSBDisplay;

type

  { TBackground }

  TBackground = class(TBasicModul)
  private
    fHandle: HDC;
    fBitmap: HBITMAP;
    fBgColor: Cardinal;

    procedure CreateBitmapHandle;
  public
    procedure Resize(const aSmall: Boolean; const aSmallW, aSmallH, aLargeW, aLargeH: Integer); override;
    procedure Update; override;
    function Draw: TDrawResult; override;
    procedure SetSettings(const aData: PSettingsItem); override;
    function SendTouchReport(const aPoint: TPoint; const aPressure: Byte; const aMode: TTouchMode): Boolean; override;

    constructor Create;
    destructor Destroy; override;
  end;

implementation

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
procedure TBackground.CreateBitmapHandle;
begin
  fBitmap := CreateBitmap(1, 1, 1, 32, @fBgColor);
  SelectObject(fHandle, fBitmap);
end;

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
procedure TBackground.Resize(const aSmall: Boolean; const aSmallW, aSmallH, aLargeW, aLargeH: Integer);
begin

end;

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
procedure TBackground.Update;
begin

end;

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
function TBackground.Draw: TDrawResult;
begin
  with result do begin
    Handle      := fHandle;
    Width       := 1;
    Height      := 1;
    Transparent := true;
  end;
end;

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
procedure TBackground.SetSettings(const aData: PSettingsItem);
begin
  inherited SetSettings(aData);
  CreateBitmapHandle;
end;

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
function TBackground.SendTouchReport(const aPoint: TPoint; const aPressure: Byte; const aMode: TTouchMode): Boolean;
begin
  Result := inherited SendTouchReport(aPoint, aPressure, aMode);
end;

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
constructor TBackground.Create;
begin
  inherited Create;
  fHandle := CreateCompatibleDC(GetDC(0));
  fBgColor := $60000000;
  CreateBitmapHandle;
end;

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
destructor TBackground.Destroy;
begin
  DeleteObject(fBitmap);
  DeleteDC(fHandle);
  inherited Destroy;
end;

end.

